<div class="game-map-container">
  <div class="main-content">
    <app-map-viewer [baseScale]="0.75" [currentMap]="currentMap" [zoomLevel]="zoomLevel" [panOffsetX]="panOffsetX"
      [panOffsetY]="panOffsetY" [markers]="markers" [objectives]="currentMap?.objectives || []"
      [drawnLines]="drawnLines" [isDrawingMode]="isDrawingMode" [isEraserMode]="isEraserMode"
      [selectedMarker]="selectedMarker" [selectedDrawColor]="selectedDrawColor" [legendItems]="legendItems"
      [isPanning]="isPanning" [isDrawing]="isDrawing" [drawingPath]="drawingPath" [isLoading]="isLoading"
      [isChallengeModalOpen]="isChallengeModalOpen" (mapClick)="onMapClick($event)"
      (markerClick)="onMarkerClick($event)" (mouseWheel)="onMouseWheel($event)" (mouseDown)="onMouseDown($event)"
      (touchStart)="onTouchStart($event)" (layerSelected)="onLayerSelected($event)"></app-map-viewer>

    @if (currentMap) {
    <app-zoom-controls [zoomLevel]="zoomLevel" [minZoom]="minZoom" [maxZoom]="maxZoom" (zoomIn)="onZoomIn()"
      (zoomOut)="onZoomOut()" (resetZoom)="onResetZoom()"></app-zoom-controls>

    <!-- Objectives moved to bottom on mobile -->
    <app-objectives class="objectives-mobile" [objectives]="currentMap.objectives || []"
      [mapName]="currentMapMetadata?.name || ''" (objectiveToggled)="onObjectiveToggled($event)"></app-objectives>
    }
  </div>

  <!-- Mobile Sidebar Toggle Button -->
  <button class="sidebar-toggle-btn" [class.collapsed]="isSidebarCollapsed" (click)="toggleSidebar()"
    aria-label="Toggle Menu">
    <span class="material-icons">{{ isSidebarCollapsed ? 'expand_more' : 'expand_less' }}</span>
  </button>

  <div class="sidebar" [class.collapsed]="isSidebarCollapsed">
    <app-map-selector [maps]="availableMaps" [currentMapId]="currentMap?.id || null" [currentMap]="currentMap"
      [currentMapMetadata]="currentMapMetadata"
      (mapSelected)="onMapSelected($event)"></app-map-selector>

    @if (currentMap) {
    <app-drawing-tools [isDrawingMode]="isDrawingMode" [selectedColor]="selectedDrawColor"
      [hasDrawings]="drawnLines.length > 0" [isEraserMode]="isEraserMode"
      (drawingModeToggled)="onDrawingModeToggled($event)" (colorSelected)="onColorSelected($event)"
      (clearDrawings)="onClearDrawings()" (eraserModeToggled)="onEraserModeToggled($event)"></app-drawing-tools>
    <app-random-challenge [maps]="availableMaps"
      (modalStateChanged)="onChallengeModalStateChanged($event)"></app-random-challenge>
    <app-map-legend [legendItems]="legendItems" (legendItemToggled)="onLegendItemToggled($event)"
      (showAll)="onShowAllLegend()" (hideAll)="onHideAllLegend()"></app-map-legend>
    }

    @if (showMarkerForm) {
    <app-marker-form [x]="newMarkerX" [y]="newMarkerY" [markerTypes]="['spawn', 'hard_objective', 'soft_objective']"
      (markerSaved)="onMarkerSaved($event)" (formClosed)="onMarkerFormClosed()"></app-marker-form>
    }

    <div class="copyright">
      <p class="copyright-disclaimer">
        Ready or Not is a trademark of <a href="https://voidinteractive.net/" target="_blank">VOID Interactive</a>. This
        is a fan-made project.
      </p>
      <p class="copyright-developer">
        Site development and design by <strong>serM4rkus</strong><br>
        Blueprints development and design by <strong>eNex and Daan</strong><br>
        <a href="http://steamcommunity.com/sharedfiles/filedetails/?id=3137562299" target="_blank">Blueprints Steam
          Guide</a>
      </p>
      <p class="copyright-text">
        Â© 2025 Ready or Maps.
      </p>
    </div>
  </div>