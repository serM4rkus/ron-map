<div class="game-map-container">
  <div class="main-content">
    <app-map-viewer
      [baseScale]="0.75"
      [currentMap]="currentMap"
      [zoomLevel]="zoomLevel"
      [panOffsetX]="panOffsetX"
      [panOffsetY]="panOffsetY"
      [markers]="markers"
      [drawnLines]="drawnLines"
      [isDrawingMode]="isDrawingMode"
      [isEraserMode]="isEraserMode"
      [selectedMarker]="selectedMarker"
      [selectedDrawColor]="selectedDrawColor"
      [legendItems]="legendItems"
      [isPanning]="isPanning"
      [isDrawing]="isDrawing"
      [drawingPath]="drawingPath"
      [isLoading]="isLoading"
      (mapClick)="onMapClick($event)"
      (markerClick)="onMarkerClick($event)"
      (mouseWheel)="onMouseWheel($event)"
      (mouseDown)="onMouseDown($event)"
      (layerSelected)="onLayerSelected($event)"
    ></app-map-viewer>

    @if (currentMap) {
      <app-zoom-controls
        [zoomLevel]="zoomLevel"
        [minZoom]="minZoom"
        [maxZoom]="maxZoom"
        (zoomIn)="onZoomIn()"
        (zoomOut)="onZoomOut()"
        (resetZoom)="onResetZoom()"
      ></app-zoom-controls>
    }
  </div>

  <div class="sidebar">
    <app-map-selector
      [maps]="availableMaps"
      [currentMapId]="currentMap?.id || null"
      [availableLanguages]="availableLanguages"
      [currentLanguage]="currentLanguage"
      (mapSelected)="onMapSelected($event)"
      (languageChanged)="onLanguageChanged($event)"
    ></app-map-selector>

    @if (currentMap) {
      <app-drawing-tools
        [isDrawingMode]="isDrawingMode"
        [selectedColor]="selectedDrawColor"
        [colors]="drawColors"
        [hasDrawings]="drawnLines.length > 0"
        [isEraserMode]="isEraserMode"
        (drawingModeToggled)="onDrawingModeToggled($event)"
        (colorSelected)="onColorSelected($event)"
        (clearDrawings)="onClearDrawings()"
        (eraserModeToggled)="onEraserModeToggled($event)"
      ></app-drawing-tools>

      <app-map-legend
        [legendItems]="legendItems"
        (legendItemToggled)="onLegendItemToggled($event)"
        (showAll)="onShowAllLegend()"
        (hideAll)="onHideAllLegend()"
      ></app-map-legend>
    }

    <!-- Language Switcher -->
    <div class="language-switcher">
      @for (lang of availableLanguages; track lang.code) {
      <button 
        class="language-button" 
        [class.active]="currentLanguage === lang.code"
        (click)="onLanguageChanged(lang.code)"
        [title]="lang.name"
      >
        <span class="flag-emoji">{{ lang.flag }}</span>
        <span class="flag-text">{{ lang.textCode || lang.code.toUpperCase() }}</span>
      </button>
      }
    </div>
  </div>

  @if (showMarkerForm) {
    <app-marker-form
      [x]="newMarkerX"
      [y]="newMarkerY"
      [markerTypes]="['spawn', 'hard_objective', 'soft_objective']"
      (markerSaved)="onMarkerSaved($event)"
      (formClosed)="onMarkerFormClosed()"
    ></app-marker-form>
  }
</div>
