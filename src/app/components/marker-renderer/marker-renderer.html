<div class="markers-container">
  @for (marker of getVisibleMarkers(); track marker.id) {
    <div class="marker-wrapper" 
      [ngClass]="getMarkerClass(marker)" 
      [ngStyle]="getMarkerStyle(marker)"
      (click)="onMarkerClick(marker, $event)"
      (keydown)="($event.key === 'Enter' || $event.key === ' ') && onMarkerClick(marker, $event)"
      (mouseenter)="onMarkerHover(marker)"
      (mouseleave)="onMarkerHoverLeave()">
      
      <div class="marker-icon" 
        [style.backgroundColor]="getMarkerColor(marker)">
        @if (getMarkerSvgUrl(marker)) {
          <img class="marker-svg" [src]="getMarkerSvgUrl(marker)" [alt]="marker.title" draggable="false" />
        } @else {
          <span class="material-icons" 
            [style.color]="getMarkerIconColor(marker)">
            {{ getMarkerIcon(marker) }}
          </span>
        }
      </div>
      
      <div class="marker-label">{{ marker.title }}</div>

      @if (shouldShowTooltip(marker)) {
        <div class="marker-tooltip" [class.no-description]="!marker.description">
          <h4>{{ marker.title }}</h4>
          @if (marker.description) {
            <p>{{ marker.description }}</p>
          }
        </div>
      }

      @if (showingConnectionsForMarkerId === marker.id && marker.connections && marker.connections.length > 1) {
        <div class="connection-menu" (click)="$event.stopPropagation()">
          <div class="connection-menu-header">
            <h4>Choose Destination</h4>
            <button class="connection-close-btn" (click)="closeConnectionMenu()">Ã—</button>
          </div>
          <div class="connection-options">
            @for (connection of marker.connections; track connection) {
              <button class="connection-option" (click)="navigateToMarker(getConnectionTargetId(connection), marker.id)">
                <span class="material-icons">arrow_forward</span>
                {{ getConnectionTitle(connection) }}
              </button>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
